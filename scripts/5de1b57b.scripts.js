"use strict";angular.module("b",["ngRoute","b.filters","b.services","b.directives","b.directives.height","b.directives.fileDrop","b.services.fileReader"]).config(["$routeProvider",function(a){a.when("/view1",{templateUrl:"scripts/main/view1/view1.tpl.html",controller:"view1Ctrl"}),a.when("/view2",{templateUrl:"scripts/main/view2/view2.tpl.html",controller:"view2Ctrl"}),a.otherwise({redirectTo:"/view1"})}]),angular.module("b.services",[]).value("version","0.1"),angular.module("b").controller("view1Ctrl",["$scope",function(){}]),angular.module("b").controller("view2Ctrl",["$scope","fileReader",function(a,b){a.image=null,a.imageFileName="",a.fileMeta={},a.$watch("fileMeta.uuid",function(){a.fileMeta.file&&(console.log("type",a.fileMeta.file.type),b(a.fileMeta.file).then(function(b){0==a.fileMeta.file.type.indexOf("text")?a.text=b:a.image=b},null,function(a){console.log("progress",a)}))})}]),angular.module("b.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("b.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]),angular.module("b.directives.height",[]).directive("resizeHeight",["$window",function(a){function b(a,b){return-1!==a.indexOf(b,a.length-b.length)}function c(a,c){if(!c)return a;if(c=c.trim(),b(c,"%")){var d=c.substr(0,c.length-1);return a-Math.round(a*parseInt(d)/100)}return a-parseInt(c)}return{replace:!1,restrict:"EA",scope:{offset:"@"},link:function(b,d){var e=angular.element(a),f=function(){d.height(c(e.innerHeight(),b.offset))};e.bind("resize",_.debounce(f,50)),f(),b.$on("$destroy",function(){e.unbind("resize")})}}}]),angular.module("b.directives.fileDrop",[]).directive("fileDrop",function(){return{restrict:"EA",scope:{fileMeta:"="},link:function(a,b){var c=1;jQuery&&jQuery.event.props.push("dataTransfer");var d=function(b){return null==b?!1:(b.preventDefault(),a.$apply(function(){a.fileMeta={uuid:c++,file:b.dataTransfer.files[0],name:b.dataTransfer.files[0].name}}),!1)};b.bind("dragover",function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}),b.bind("dragenter",function(a){a.stopPropagation(),a.preventDefault(),b.addClass("on-drag-enter")}),b.bind("dragleave",function(a){a.stopPropagation(),a.preventDefault(),b.removeClass("on-drag-enter")}),b.bind("drop",function(a){return a.stopPropagation(),a.preventDefault(),b.removeClass("on-drag-enter"),d(a)})}}}),angular.module("b.services.fileReader",[]).factory("fileReader",["$q",function(a){var b=function(a,b){return function(){b.resolve(a.result)}},c=function(a,b){return function(){b.reject(a.result)}},d=function(a){return function(b){a.notify({total:b.total,loaded:b.loaded})}},e=function(a){var e=new FileReader;return e.onload=b(e,a),e.onerror=c(e,a),e.onprogress=d(a),e};return function(b){var c=a.defer(),d=e(c);return 0==b.type.indexOf("text")?d.readAsText(b):d.readAsDataURL(b),c.promise}}]),angular.module("b").run(["$templateCache",function(a){a.put("scripts/main/view1/view1.tpl.html",'<div resize-height offset="19" style="background: #e8e5e5">\n  <p>Content1.</p>\n</div>\n\n<div resize-height offset="19" style="background: #f8e5e5">\n  <p>Content 2.</p>\n</div>\n\n'),a.put("scripts/main/view2/view2.tpl.html","<p>This is the partial for view 2.</p>\n<p>\n  Showing of 'interpolate' filter:\n  {{ 'Current version is v%VERSION%.' | interpolate }}\n</p>\n\n"+'<div class="dropzone" file-drop="[image/png, image/jpeg, image/gif]"\n     file-meta="fileMeta">\n  Drop image or text/* file here\n</div>\n\n<div>{{text}}</div>\n\n<div class="image-container">\n  <img ng-src="{{image}}"/>\n  <span class="file-name">{{fileMeta.name}}</span>\n</div>\n\n')}]);